<html>
  <head>
    <title>Routes Staging App Redirect</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script>
      document.addEventListener("DOMContentLoaded", function (event) {
        function removeURLParameter(url, parameter) {
          //prefer to use l.search if you have a location/link object
          var urlparts = url.split("?");
          if (urlparts.length >= 2) {
            var prefix = encodeURIComponent(parameter) + "=";
            var pars = urlparts[1].split(/[&;]/g);

            //reverse iteration as may be destructive
            for (var i = pars.length; i-- > 0; ) {
              //idiom for string.startsWith
              if (pars[i].lastIndexOf(prefix, 0) !== -1) {
                pars.splice(i, 1);
              }
            }

            url = urlparts[0] + "?" + pars.join("&");
            return url;
          } else {
            return url;
          }
        }

        var link = document.getElementById("link");

        var baseUri = "";
        const url = document.location.search;
        // Take the uri from the params
        var qs = decodeURIComponent(document.location.search);
        console.log({ qs, url: document.location });
        if (qs) {
          const spl = qs.split("?")[0] + "?";
          let extractedRedirect = qs.replace(spl, "");

          /* if (extractedRedirect.includes("release-channel")) {
            const removed = removeURLParameter(
              extractedRedirect,
              "release-channel"
            );
            console.log({ removed });

            extractedRedirect = removed;
          }

          */
          baseUri = extractedRedirect;
        }

        // Update the link urls
        link.href = extractedRedirect;

        var redirectInterval = setInterval(function () {
          var countdown = document.querySelector(".countdown");
          var t = parseInt(countdown.innerText, 10);
          t -= 1;

          countdown.innerText = t;

          if (t === 0) {
            clearInterval(redirectInterval);
            console.log(extractedRedirect);
            link.click();
          }
        }, 1000);
      });
    </script>
  </head>

  <body>
    <p>
      Redirecting automatically back to app in
      <span class="countdown">5</span> seconds
    </p>
    <a id="link">Open App</a>
  </body>
</html>
